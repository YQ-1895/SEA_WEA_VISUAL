"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{3072:function(a,i,n){n.d(i,{getBasinSystem:function(){return getBasinSystem}});var e=n(1857);function pointInPolygon(a,i){let[n,e]=a,t=!1;for(let a=0,s=i.length-1;a<i.length;s=a++){let[o,r]=i[a],[l,u]=i[s];r>e!=u>e&&n<(l-o)*(e-r)/(u-r)+o&&(t=!t)}return t}let SimplifiedBasinSystem=class SimplifiedBasinSystem{async initialize(){if(!this.initialized)try{console.log("\uD83D\uDD04 加载basin边界数据...");try{let a=await fetch((0,e.K)("/data/basins_boundary.geojson"));a.ok&&(this.boundaryData=await a.json(),console.log("✅ 成功加载basins_boundary.geojson"))}catch(a){console.log("ℹ️ basins_boundary.geojson未找到，使用SEA_boundary.geojson作为测试")}if(!this.boundaryData){let a=await fetch((0,e.K)("/data/SEA_boundary.geojson"));if(a.ok)this.boundaryData=await a.json(),console.log("✅ 成功加载SEA_boundary.geojson作为测试数据");else throw Error("无法加载任何边界数据")}this.initialized=!0,console.log("✅ Basin系统初始化完成，包含".concat(this.boundaryData.features.length,"个区域"))}catch(a){console.error("❌ Basin系统初始化失败:",a),this.initialized=!1}}getBasin(a,i){if(!this.initialized||!this.boundaryData)return this.getFallbackBasin(a,i);let n="".concat(a.toFixed(4),",").concat(i.toFixed(4));if(this.cache.has(n))return this.cache.get(n);let e=[i,a];for(let a of this.boundaryData.features){let i=this.getBasinName(a);if(this.isPointInFeature(e,a))return this.cache.set(n,i),i}let t=this.getFallbackBasin(a,i);return this.cache.set(n,t),t}getBasinName(a){let i=a.properties;return i.basin_name?i.basin_name:i.basin?i.basin:i.name&&"basin"===i.type?i.name:i.name?this.countryToBasin(i.name):"Unknown Basin"}countryToBasin(a){return({Vietnam:"Mekong River Basin",Cambodia:"Mekong River Basin",Laos:"Mekong River Basin",Thailand:"Chao Phraya Basin",Myanmar:"Irrawaddy River Basin",China:"Pearl River Basin",Malaysia:"Peninsular Malaysia Basins",Indonesia:"Indonesian River Basins",Philippines:"Philippine River Basins",Singapore:"Singapore River Basin"})[a]||"".concat(a," River Basins")}isPointInFeature(a,i){let n=i.geometry;if("Polygon"===n.type)return pointInPolygon(a,n.coordinates[0]);if("MultiPolygon"===n.type){for(let i of n.coordinates)if(pointInPolygon(a,i[0]))return!0}return!1}getFallbackBasin(a,i){return a>=20&&a<=30&&i>=102&&i<=108?"Red River Basin":a>=8&&a<=22&&i>=95&&i<=108?"Mekong River Basin":a>=15&&a<=28&&i>=93&&i<=101?"Irrawaddy River Basin":a>=13&&a<=18&&i>=99&&i<=102?"Chao Phraya Basin":a>=21&&a<=26&&i>=110&&i<=117?"Pearl River Basin":a>=1&&a<=7&&i>=99&&i<=105?"Peninsular Malaysia Basins":"Other Southeast Asian Basins"}assignBasinsBatch(a){return a.map(a=>({...a,basin:this.getBasin(a.latitude,a.longitude)}))}getBasinStats(a){let i={};return a.forEach(a=>{let n=this.getBasin(a.latitude,a.longitude);i[n]=(i[n]||0)+1}),Object.entries(i).sort((a,i)=>{let[,n]=a,[,e]=i;return e-n}).reduce((a,i)=>{let[n,e]=i;return a[n]=e,a},{})}clearCache(){this.cache.clear(),console.log("\uD83E\uDDF9 Basin分配缓存已清除")}constructor(){this.boundaryData=null,this.cache=new Map,this.initialized=!1}};let t=null;async function getBasinSystem(){return t||(t=new SimplifiedBasinSystem,await t.initialize()),t}}}]);